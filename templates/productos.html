<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>CRUD Productos - Flask & PostgreSQL</title>
    <style>
        body { font-family: sans-serif; margin: 20px; background-color: #f4f4f9; }
        .container { max-width: 1000px; margin: auto; background: white; padding: 20px; border-radius: 8px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        h1, h2 { color: #333; border-bottom: 2px solid #eee; padding-bottom: 10px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 12px; border: 1px solid #ddd; text-align: left; }
        th { background-color: #007bff; color: white; }
        tr:nth-child(even) { background-color: #f2f2f2; }
        form { background: #fff; padding: 15px; margin-bottom: 20px; border: 1px solid #ccc; border-radius: 5px; }
        input[type="text"], input[type="number"] { padding: 8px; margin: 5px 0; width: 90%; border: 1px solid #ccc; border-radius: 4px; }
        button { background-color: #28a745; color: white; padding: 10px 15px; border: none; border-radius: 4px; cursor: pointer; margin-right: 5px; }
        button:hover { opacity: 0.9; }
        .delete-btn { background-color: #dc3545; }
        .edit-btn { background-color: #ffc107; }
        .success-msg { color: green; }
        .error-msg { color: red; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Gestor de Productos CRUD</h1>

        {% if producto_a_editar %}
            <h2>üõ†Ô∏è Editar Producto ID: {{ producto_a_editar.id }}</h2>
            <form method="POST" action="{{ url_for('ui_editar_producto', producto_id=producto_a_editar.id) }}">
                <input type="text" name="nombre" placeholder="Nombre" value="{{ producto_a_editar.nombre }}" required><br>
                <input type="number" step="0.01" name="precio" placeholder="Precio" value="{{ producto_a_editar.precio }}" required><br>
                <input type="number" name="stock" placeholder="Stock" value="{{ producto_a_editar.stock }}"><br>
                <button type="submit" style="background-color: #ffc107;">Guardar Cambios</button>
                <a href="{{ url_for('ui_productos') }}" style="color: #6c757d; margin-left: 10px;">Cancelar</a>
            </form>
        {% else %}
            <h2>‚ûï Crear Nuevo Producto</h2>
            <form method="POST" action="{{ url_for('ui_productos') }}">
                <input type="text" name="nombre" placeholder="Nombre del Producto" required><br>
                <input type="number" step="0.01" name="precio" placeholder="Precio (ej: 99.99)" required><br>
                <input type="number" name="stock" placeholder="Stock (ej: 10)" value="0"><br>
                <button type="submit">Crear Producto</button>
            </form>
        {% endif %}

        <hr>

        <h2>üì¶ Listado de Productos ({{ productos | length }} resultados)</h2>
        {% if productos %}
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>Nombre</th>
                        <th>Precio</th>
                        <th>Stock</th>
                        <th>Creado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody>
                    {% for producto in productos %}
                        <tr>
                            <td>{{ producto.id }}</td>
                            <td>{{ producto.nombre }}</td>
                            <td>${{ "%.2f" | format(producto.precio) }}</td>
                            <td>{{ producto.stock }}</td>
                            <td>{{ producto.fecha_creacion }}</td>
                            <td>
                                <a href="{{ url_for('ui_editar_producto', producto_id=producto.id) }}">
                                    <button type="button" class="edit-btn">Editar</button>
                                </a>

                                <form method="POST" action="{{ url_for('ui_eliminar_producto', producto_id=producto.id) }}" style="display: inline;" onsubmit="return confirm('¬øEst√° seguro de eliminar el producto {{ producto.nombre }}?');">
                                    <button type="submit" class="delete-btn">Eliminar</button>
                                </form>
                            </td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No hay productos registrados.</p>
        {% endif %}
    </div>
</body>
</html>